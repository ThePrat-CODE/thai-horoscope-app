import streamlit as st
import swisseph as swe
import datetime
import pytz

st.set_page_config(page_title="‡πÄ‡∏ä‡πá‡∏Å‡∏î‡∏ß‡∏á‡πÑ‡∏ó‡∏¢", layout="centered")

st.title("üîÆ ‡πÄ‡∏ä‡πá‡∏Å‡∏î‡∏ß‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏î‡∏ß‡∏á‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢")
st.markdown("‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏û‡∏∑‡πâ‡∏ô‡∏î‡∏ß‡∏á‡∏ï‡∏≤‡∏°‡πÇ‡∏´‡∏£‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÑ‡∏ó‡∏¢")

# ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
col1, col2 = st.columns(2)
with col1:
   birth_date = st.date_input(
    "üìÖ ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î",
    value=datetime.date(1995, 1, 1),
    min_value=datetime.date(1900, 1, 1),
    max_value=datetime.date.today()
)
with col2:
    birth_time = st.time_input("üï∞Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡∏¥‡∏î")

province = st.text_input("üìç ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î (‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)", value="‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û")

# ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤
timezone = pytz.timezone("Asia/Bangkok")
birth_datetime = datetime.datetime.combine(birth_date, birth_time)
birth_datetime_utc = timezone.localize(birth_datetime).astimezone(pytz.utc)

# ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Julian Day
jd = swe.julday(birth_datetime_utc.year, birth_datetime_utc.month,
                birth_datetime_utc.day, birth_datetime_utc.hour +
                birth_datetime_utc.minute / 60)

# ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û (‡∏à‡∏∏‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á)
swe.set_topo(100.5018, 13.7563)

# ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏î‡∏≤‡∏ß‡∏û‡∏∑‡πâ‡∏ô‡∏î‡∏ß‡∏á
planets = {
    "‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå (Sun)": swe.SUN,
    "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå (Moon)": swe.MOON,
    "‡∏û‡∏∏‡∏ò (Mercury)": swe.MERCURY,
    "‡∏®‡∏∏‡∏Å‡∏£‡πå (Venus)": swe.VENUS,
    "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£ (Mars)": swe.MARS,
    "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ (Jupiter)": swe.JUPITER,
    "‡πÄ‡∏™‡∏≤‡∏£‡πå (Saturn)": swe.SATURN,
    "‡∏£‡∏≤‡∏´‡∏π (Rahu)": swe.TRUE_NODE
}

st.subheader("üåü ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏î‡∏≤‡∏ß‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì")
# ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡πÉ‡∏ô‡πÄ‡∏Ç‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢)
thai_weekdays = ["‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£", "‡∏û‡∏∏‡∏ò", "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ", "‡∏®‡∏∏‡∏Å‡∏£‡πå", "‡πÄ‡∏™‡∏≤‡∏£‡πå", "‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå"]
today = datetime.datetime.now(pytz.timezone("Asia/Bangkok"))
today_weekday = thai_weekdays[today.weekday()]

# ‡∏™‡∏µ‡∏°‡∏á‡∏Ñ‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á
lucky_colors = {
    "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå": "‡∏Ç‡∏≤‡∏ß, ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á",
    "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£": "‡∏ä‡∏°‡∏û‡∏π",
    "‡∏û‡∏∏‡∏ò": "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß",
    "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ": "‡∏™‡πâ‡∏°, ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á",
    "‡∏®‡∏∏‡∏Å‡∏£‡πå": "‡∏ü‡πâ‡∏≤, ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô",
    "‡πÄ‡∏™‡∏≤‡∏£‡πå": "‡∏°‡πà‡∏ß‡∏á, ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏°",
    "‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå": "‡πÅ‡∏î‡∏á"
}

unlucky_colors = {
    "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå": "‡πÅ‡∏î‡∏á",
    "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£": "‡∏Ç‡∏≤‡∏ß",
    "‡∏û‡∏∏‡∏ò": "‡∏ä‡∏°‡∏û‡∏π",
    "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ": "‡∏°‡πà‡∏ß‡∏á",
    "‡∏®‡∏∏‡∏Å‡∏£‡πå": "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß",
    "‡πÄ‡∏™‡∏≤‡∏£‡πå": "‡∏™‡πâ‡∏°",
    "‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå": "‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô"
}

st.write(f"‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏±‡∏ô **{today_weekday}**")
st.success(f"üé® ‡∏™‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏°‡∏á‡∏Ñ‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: {lucky_colors[today_weekday]}")
st.error(f"‚õî ‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á: {unlucky_colors[today_weekday]}")

st.subheader("üìÖ ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏™‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å")

selected_date = st.date_input("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏™‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠", value=datetime.date.today())
selected_weekday = selected_date.weekday()  # 0 = Monday, 6 = Sunday

thai_weekdays = ["‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£", "‡∏û‡∏∏‡∏ò", "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ", "‡∏®‡∏∏‡∏Å‡∏£‡πå", "‡πÄ‡∏™‡∏≤‡∏£‡πå", "‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå"]
day_name = thai_weekdays[selected_weekday]

lucky_colors = {
    "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå": "‡∏Ç‡∏≤‡∏ß, ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á",
    "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£": "‡∏ä‡∏°‡∏û‡∏π",
    "‡∏û‡∏∏‡∏ò": "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß",
    "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ": "‡∏™‡πâ‡∏°, ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á",
    "‡∏®‡∏∏‡∏Å‡∏£‡πå": "‡∏ü‡πâ‡∏≤, ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô",
    "‡πÄ‡∏™‡∏≤‡∏£‡πå": "‡∏°‡πà‡∏ß‡∏á, ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏°",
    "‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå": "‡πÅ‡∏î‡∏á"
}

unlucky_colors = {
    "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå": "‡πÅ‡∏î‡∏á",
    "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£": "‡∏Ç‡∏≤‡∏ß",
    "‡∏û‡∏∏‡∏ò": "‡∏ä‡∏°‡∏û‡∏π",
    "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ": "‡∏°‡πà‡∏ß‡∏á",
    "‡∏®‡∏∏‡∏Å‡∏£‡πå": "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß",
    "‡πÄ‡∏™‡∏≤‡∏£‡πå": "‡∏™‡πâ‡∏°",
    "‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå": "‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô"
}

st.write(f"‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏±‡∏ô **{day_name}**")
st.success(f"üé® ‡∏™‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏°‡∏á‡∏Ñ‡∏•: {lucky_colors[day_name]}")
st.error(f"‚õî ‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á: {unlucky_colors[day_name]}")

for name, code in planets.items():
    pos, _ = swe.calc_ut(jd, code)
    degree = pos[0] % 30
    sign = int(pos[0] // 30)
    rasi = ["‡πÄ‡∏°‡∏©", "‡∏û‡∏§‡∏©‡∏†", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô", "‡∏Å‡∏£‡∏Å‡∏é", "‡∏™‡∏¥‡∏á‡∏´‡πå", "‡∏Å‡∏±‡∏ô‡∏¢‡πå",
            "‡∏ï‡∏∏‡∏•", "‡∏û‡∏¥‡∏à‡∏¥‡∏Å", "‡∏ò‡∏ô‡∏π", "‡∏°‡∏Å‡∏£", "‡∏Å‡∏∏‡∏°‡∏†‡πå", "‡∏°‡∏µ‡∏ô"]
    st.write(f"- {name} ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà {degree:.2f}¬∞ ‡∏£‡∏≤‡∏®‡∏µ {rasi[sign]}")
